---
title: 'Cognitive Aspects of Software Development: a SMS'
output:
  html_document:
    df_print: tibble
    fig_caption: yes
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r}
# Keep things nice and tidy, all libraries go here
library(readxl)
library(tidyverse)
library(knitr)
library(kableExtra)
library(svglite)
library(plotly)
library(scales)
library(ggsci)
```
```{r}
data <- read_excel("data.xlsx", skip = 1)
data <- data %>% filter(is.na(Exclude)) 
```

# Visualizing number of publications over time
```{r}
ggplot(data, aes(x=as.factor(Year))) + 
  geom_bar() +  
  ylab("Number of publications") +
  xlab("Year") + 
  geom_text(stat='count', aes(label=..count..), vjust=2, color="white", size = 2.5) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
ggsave("yearly_distribution.eps")
```


```{r}

# Cleaning not needed values 
data<-data %>% 
    mutate(Academia = replace(Academia, Academia == "?", NA)) %>%
    mutate(Industry = replace(Industry, Industry == "?", NA))

data<-data %>%
  mutate(Type = case_when(is.na(Academia) & is.na(Industry) ~ "None", 
                       Academia == "1.0" & is.na(Industry) ~ "Academia",
                       Industry == "1.0" & is.na(Academia) ~ "Industry", 
                       TRUE ~ "Both"))
```

# Number of publications according to their type
```{r}
data %>% 
  mutate(Type = fct_infreq(Type, ordered = T)) %>% 
ggplot(aes(x=Type)) + 
  geom_bar(width = .5) +
  xlab("Type of publication") + 
  ylab("Number of publications") + 
  geom_text(stat='count', aes(label=..count..), vjust=3, color="white", size = 4) +
  theme_bw()
ggsave("academia_industry_distribution.eps")
```

# Number of publications categorized according to SWEBoK Areas. 
A publication can be in more than one category at the same time.

```{r}
data %>% 
  select(7:21) %>% # selecting columns corresponding to the SWEBoK Areas
  mutate_all(replace_na,0) %>% 
  summarise_all(sum) %>% 
  gather(key = "SWEBOKArea", value = "publications", 1:15) %>% 
  arrange(-publications) %>%  
  mutate(SWEBOKArea = factor(SWEBOKArea, SWEBOKArea)) %>% 
  ggplot(aes(x=SWEBOKArea, y=publications)) + 
  geom_bar(stat="identity") + 
  geom_text(aes(label=publications), vjust=-0.3, color="black", size = 4) + 
  xlab("SWEBoK Area") + 
  ylab("Number of publications") +
  theme_bw()

ggsave("swebok_distribution.eps")
```

# Co-occurrences of SWEBoK Areas
```{r}
swebokareas<-data %>% 
  select(7:21) %>% # selecting columns corresponding to the SWEBoK Areas
  mutate_all(replace_na,0) %>% 
  as.matrix() %>% 
  crossprod()

swebokareas %>% 
  kable()

plot_ly(x=c("SR", "SD", "SC", "ST", "SM", "SEM", "SEP", "SEMM", "SQ", "SEPP", "SEE", "CF", "MF", "EF"), y=c("SR", "SD", "SC", "ST", "SM", "SEM", "SEP", "SEMM", "SQ", "SEPP", "SEE", "CF", "MF", "EF"), z=swebokareas, type="heatmap")
```

```{r}
x <- data %>% select(7:21, matches('Attention|Memory|Cognitive load|CL$|Problem solving|Reasoning|Decision making|Errors| biases$' )) %>%
  mutate_all(replace_na, 0) %>%
  mutate(`Problem solving`, `Problem solving` = as.numeric(`Problem solving`)) %>% 
  gather(key="SWEBOK", value = pubs, 1:15) %>% # use SWEBOK area as factor
  filter(pubs > 0) %>% # select areas for which there are publications
  group_by(SWEBOK) %>% 
  summarise_all(sum) %>% # number of publication for each area 
  select(-pubs) %>%  # remove pubs to reuse it later
  gather(key = "Taxonomy", value = "count", 2:17) %>%  # count publications in each cognitive taxonomy area
  mutate(label = str_replace(as.character(count), "^0", "")) # add label for later
```
```{r}
# Bubble plot
x <- arrange(x, Taxonomy)
xf<-x$Taxonomy
xfu<-unique(xf)
x$Taxonomy<-factor(xf,levels=xfu)

p<-ggplot(x)
p + geom_point(aes(x = fct_infreq(SWEBOK), y = fct_rev(Taxonomy), size=count), shape=21, fill="white", alpha=0.60) +
geom_text(aes(x = fct_infreq(SWEBOK), y = fct_rev(Taxonomy), label=label), size=2) +
theme(axis.text.x = element_text(angle = 45, hjust = 1.1, size=9,colour="black"), axis.text.y = element_text(size=8,colour="black"), axis.title.x = element_text(size=10), axis.title.y = element_text(size=10,colour = "black",vjust=0.12), panel.grid.major = element_line(linetype = "dashed", size=0.1, color="black"))+
  labs(x="SWEBOK Area",y = "Taxonomy Area") + theme_bw()
ggsave("swebok_taxonomy_bubble.pdf")
```
```{r}
# Preparing the dataset for analysing the research methods
data<-data %>%
  mutate(Quantitative = case_when(`Quantit. measures` == 1 | `Task performance` == 1 | `Physiological meas.` == 1 | `Subjective ratings` == 1 | `Behavioral meas.` == 1 ~ 1)) %>% 
  mutate(Quantitative = replace_na(Quantitative, 0)) %>%  
  mutate(Qualitative = case_when(Fieldwork == 1 | Interview == 1 | `Qualit. measures` == 1 | `Task-based` == 1 | `Open observation` == 1 ~ 1)) %>%  
  mutate(Qualitative = replace_na(Qualitative, 0)) %>% 
  mutate(Both = if_else(Qualitative == 1 & Quantitative == 1, 1, 0))

```


# The graphs below are prepared for IEEE Software Submission

Number of publications per year according to SWEBOK areas
```{r}
# Creating a temp dataset with missing publications years (i.e., year for which there was no publication)
data %>% 
  filter(is.na(Exclude)) %>% 
  select(c(Year, SR:EF)) %>% 
  gather("SWEBOK", "publications", 2:16) %>% 
  mutate_all(replace_na, 0) %>%
  group_by(Year,SWEBOK)  %>% 
  summarise(total=sum(publications)) %>% 
  ggplot(aes(x=as.factor(Year), fill=SWEBOK, y=total)) +  geom_bar(stat="sum") +
  xlab("Year") + ylab("Publications") + scale_fill_discrete(name = "SWEBOK Areas") + guides(size = F) + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6))

ggsave("years_swebok.pdf")
```

### Evolution of research methods over the years
```{r}
data <-  data %>% complete(Year=seq(1973,2016)) 

data <-  data %>% 
  mutate(research_method = if_else(Both==1, "Mixed", if_else(Qualitative==1, "Qualitative", "Quantitative"))) 

data %>%  ggplot(aes(x=as.factor(Year), fill=research_method)) + geom_bar() + scale_fill_discrete(name="Research method", labels = c("Mixed", "Qualitative", "Quantitative", ""), na.value = "transparent") + xlab("Year") + ylab("Publications") +   theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 5))

ggsave("years_researchmethods.pdf")
```


### Prevalence of research methods in the SWEBOK areas
```{r}
data.swebok.researchmethod <- data %>% 
  select(7:21, research_method) %>% 
  mutate_all(replace_na,0) %>% 
  group_by(research_method) %>% 
  summarise_at(vars(SR:EF), sum) %>% 
  slice(2:4) %>% 
  gather("SWEBOK", "Publications", 2:16) 

data.swebok.researchmethod %>% 
  ggplot(aes(x=reorder(SWEBOK, Publications, function(x){sum(x)}), y=Publications, fill=research_method)) + geom_bar(stat = "identity") + 
  coord_flip() + xlab("SWEBOK areas") + scale_fill_discrete(name = "Research method")

ggsave("SWBOK_researchmethods.pdf")
```
# Distribution of publications 
```{r}
data %>% 
  filter(!is.na(Identifier)) %>%
  select(Identifier, Attention:`Extrinsic CL`, Perception:`Social Cognition`, Fieldwork:`Behavioral meas.`) %>% 
  gather(Taxonomy, value, Attention:`Social Cognition`) %>% 
  filter(!is.na(value)) %>% 
  select(-value) %>% 
  gather(Method, value, Fieldwork:`Behavioral meas.`) %>% 
  filter(!is.na(value)) %>% 
  arrange(Identifier) %>% 
  select(-Identifier, -value) %>%  
  group_by(Taxonomy, Method) %>% 
  tally(name = "Amount") %>% 
  ggplot(aes(x=Method, y=Taxonomy, fill=Amount)) + 
  geom_point(aes(size=Amount), alpha=0.5) + 
  theme(legend.position = "") + theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 8))

ggsave("taxonomy_methods.pdf")
```

```{r}
data %>% 
  select(SR:SEE, Attention:`Extrinsic CL`, Perception:`Social Cognition`) %>% 
  mutate_all(replace_na,0) %>% 
  gather(Taxonomy, value2, Attention:`Social Cognition`) %>% 
  mutate(Concept = case_when(Taxonomy %in% c("Attention", "Selective attention", "Divided attention", "Sustained attention") ~ "Attention", 
                             Taxonomy %in% c("Memory", "Working memory", "Short-term memory", "Long-term memory") ~ "Memory", 
                             Taxonomy %in% c("Cognitive load", "Extrinsic CL", "Intrinsic CL") ~ "Cognitive load", 
                             Taxonomy == "Perception" ~ "Perception", 
                             Taxonomy %in% c("Problem solving", "Reasoning", "Decision making") ~ "Reasoning", 
                             Taxonomy %in% c("Errors", "Cognitive biases") ~ "Errors", 
                             Taxonomy %in% c("Knowledge", "Explicit knowledge", "Tacit knowledge",  "Techn. tacit knowl.", "Cogn. tacit knowl.") ~ "Knowledge", 
                             Taxonomy %in% c("Cognitive control", "Executive functions", "Inhibition") ~ "Cognitive control", 
                             Taxonomy=="Social Cognition" ~ "Social cognition")) %>% 
  gather(SWEBOK, value, SR:SEE) %>% 
  count(SWEBOK, Concept, value, value2) %>% 
  mutate(freq=ifelse(value==1 & value2==1, n, 0)) %>% 
  distinct(SWEBOK, Concept, freq) %>% 
  group_by(SWEBOK, Concept) %>% 
  summarize(total=sum(freq)) %>% 
  ungroup() %>% 
  ggplot(aes(fct_relevel(SWEBOK, c("SR", "SD", "SC", "ST", "SM", "SCM", "SEM", "SEP", "SEMM", "SQ", "SEPP", "SEE")), fct_rev(Concept), fill=total)) + 
  geom_tile() + scale_fill_continuous(low="#fff9f7", high="red") +
  xlab("SWEBOK area") + ylab("Concept") + guides(fill=guide_legend(title="")) + 
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 8))


ggsave("taxomony_swebok_cooccurences.pdf")
```



```{r}
data %>% 
  select(Attention:`Extrinsic CL`, Perception:`Social Cognition`,  `Qualit. measures`:`Behavioral meas.`) %>% 
  mutate_all(replace_na,0) %>% 
  gather(Taxonomy, value, Attention:`Social Cognition`) %>% 
  mutate(Concept = case_when(Taxonomy %in% c("Attention", "Selective attention", "Divided attention", "Sustained attention") ~ "Attention", 
                             Taxonomy %in% c("Memory", "Working memory", "Short-term memory", "Long-term memory") ~ "Memory", 
                             Taxonomy %in% c("Cognitive load", "Extrinsic CL", "Intrinsic CL") ~ "Cognitive load", 
                             Taxonomy == "Perception" ~ "Perception", 
                             Taxonomy %in% c("Problem solving", "Reasoning", "Decision making") ~ "Reasoning", 
                             Taxonomy %in% c("Errors", "Cognitive biases") ~ "Errors", 
                             Taxonomy %in% c("Knowledge", "Explicit knowledge", "Tacit knowledge",  "Techn. tacit knowl.", "Cogn. tacit knowl.") ~ "Knowledge", 
                             Taxonomy %in% c("Cognitive control", "Executive functions", "Inhibition") ~ "Cognitive control", 
                             Taxonomy=="Social Cognition" ~ "Social cognition")) %>% 
  gather(Method, value2, `Qualit. measures`:`Behavioral meas.`) %>% 
  count(Concept, Method, value, value2) %>%
  mutate(freq=ifelse(value==1 & value2==1, n, 0)) %>% 
  ggplot(aes(fct_relevel(Method, c("Fieldwork", "Interview", "Task-based", "Open observation", "Qualit. measures", "Task performance", "Physiological meas.", "Subjective ratings", "Behavioral meas.", "Quantit. measures")), fct_rev(Concept), fill=freq)) + 
  geom_tile() +
  geom_vline(xintercept = 5.5, size=0.5,  color="darkgrey") +
  xlab("Assessment procedure") + ylab("Concept") + guides(fill=guide_legend(title="")) + 
  scale_x_discrete(labels=c("Fieldwork", "Interview", "Task-based", "Open observation", "Others", "Task performance", "Physiological meas.", "Subjective ratings", "Behavioral meas.", "Others")) +
  annotate(geom="text", x=8, y=0.73, label="Quantitative", size=3, alpha=0.4)+ annotate(geom="text", x=3, y=0.73, label="Qualitative", size=3, alpha=0.4) +
  scale_fill_continuous(low="#fff9f7", high="darkgreen") +
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 8))

ggsave("taxonomy_method_cooccurences.pdf")
```
```{r}
data %>% 
  select(Attention:`Extrinsic CL`, Perception:`Social Cognition`, `Qualit. measures`:`Behavioral meas.`) %>% 
  mutate_all(replace_na,0) %>% 
  gather(Taxonomy, value, Attention:`Social Cognition`) %>% 
  mutate(Concept = case_when(Taxonomy %in% c("Attention", "Selective attention", "Divided attention", "Sustained attention") ~ "Attention", 
                             Taxonomy %in% c("Memory", "Working memory", "Short-term memory", "Long-term memory") ~ "Memory", 
                             Taxonomy %in% c("Cognitive load", "Extrinsic CL", "Intrinsic CL") ~ "Cognitive load", 
                             Taxonomy == "Perception" ~ "Perception", 
                             Taxonomy %in% c("Problem solving", "Reasoning", "Decision making") ~ "Reasoning", 
                             Taxonomy %in% c("Errors", "Cognitive biases") ~ "Errors", 
                             Taxonomy %in% c("Knowledge", "Explicit knowledge", "Tacit knowledge",  "Techn. tacit knowl.", "Cogn. tacit knowl.") ~ "Knowledge", 
                             Taxonomy %in% c("Cognitive control", "Executive functions", "Inhibition") ~ "Cognitive control", 
                             Taxonomy=="Social Cognition" ~ "Social cognition")) %>% 
  gather(Context, value2, Academia:Industry) %>% 
  mutate(value2 = as.integer(value2)) %>% 
  gather(Measure, value3, `Qualit. measures`:`Behavioral meas.`) %>% 
  count(Concept, Context, value, value2) %>%
  mutate(freq=ifelse(value==1 & value2==1, n, 0)) %>% 
  ggplot(aes(Context,  )) + 
  geom_bar(position = "dodge")+
  geom_tile() +
  geom_vline(xintercept = 5.5, size=0.5,  color="darkgrey") +
  xlab("Assessment procedure") + ylab("Concept") + guides(fill=guide_legend(title="")) +
  scale_fill_continuous(low="#fff9f7", high="darkgreen") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 1, size = 8))

ggsave("taxonomy_method_cooccurences.pdf")
```

```{r}
data %>% select(Year, Attention:`Extrinsic CL`, Perception:`Social Cognition`) %>% gather("Taxonomy", "publications", Attention:`Social Cognition`) %>% mutate_all(replace_na,0) %>% mutate(publications=as.integer(publications)) %>% group_by(Year, Taxonomy) %>% summarise(total=sum(publications)) %>% ggplot(aes(as.factor(Year), total, fill=Taxonomy)) + geom_bar(stat="sum") +  xlab("Year") + ylab("Publications") + scale_fill_discrete(name = "Taxonomy Areas") + guides(size = F) + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6))
```

```{r}
 df.taxonomy  <- data %>% 
  select(Year, Attention:`Extrinsic CL`, Perception:`Social Cognition`) %>%
  gather("Taxonomy", "publications", Attention:`Social Cognition`) %>% 
  mutate_all(replace_na,0) %>% 
  mutate(publications=as.integer(publications)) %>% # for some reseason recognized as char
  filter(publications>0)

# need to create a separated df to hold the percentage of publications within each year
data.percentage <-  df.taxonomy  %>% 
  group_by(Year) %>% 
  count(Taxonomy) %>% 
  mutate(ratio = scales::percent(n/sum(n)))

df.taxonomy %>% 
  ggplot(aes(x = as.factor(Year), fill = as.factor(Taxonomy))) + 
  geom_bar(position="fill") +  
  geom_text(data = data.percentage, aes(y = n,label = ratio), position = position_fill(vjust = 0.5), colour = "white", size = 1.3) + 
  xlab("Year") + ylab("Publications %") +
  scale_fill_discrete(name = "Topic") + guides(size = F) +
  scale_y_continuous(labels = percent) + 
  theme_minimal() + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) + 
  theme(legend.key.size = unit(.2, "cm"), legend.key.width = unit(0.2,"cm"), legend.title = element_text(size = 8), legend.text = element_text(size = 6))

ggsave("taxonomy_years.pdf", width = unit(9, "inch"), height = unit(6.5, "inch"))
```

```{r}
df.concepts <- df.taxonomy %>% 
  mutate(Concept = case_when(Taxonomy %in% c("Attention", "Selective attention", "Divided attention", "Sustained attention") ~ "Attention", 
                             Taxonomy %in% c("Memory", "Working memory", "Short-term memory", "Long-term memory") ~ "Memory", 
                             Taxonomy %in% c("Cognitive load", "Extrinsic CL", "Intrinsic CL") ~ "Cognitive load", 
                             Taxonomy == "Perception" ~ "Perception", 
                             Taxonomy %in% c("Problem solving", "Reasoning", "Decision making") ~ "Reasoning", 
                             Taxonomy %in% c("Errors", "Cognitive biases") ~ "Errors", 
                             Taxonomy %in% c("Knowledge", "Explicit knowledge", "Tacit knowledge",  "Techn. tacit knowl.", "Cogn. tacit knowl.") ~ "Knowledge", 
                             Taxonomy %in% c("Cognitive control", "Executive functions", "Inhibition") ~ "Cognitive control", 
                             Taxonomy=="Social Cognition" ~ "Social cognition"))

df.years <- data %>% filter(!(Year %in% c("1974", "1975", "1976", "1978"))) %>% count(Year)

ggplot() + 
  geom_bar(data=df.concepts, aes(x=as.factor(Year), fill=Concept), position="fill") + 
  geom_line(data=df.years, aes(x=as.factor(Year), y=n/max(n), group=1), size=0.8) + 
  geom_point(data=df.years, aes(x=as.factor(Year), y=n/max(n), group=1)) + 
  scale_y_continuous(labels = function(x)x*100, name="Publication %", sec.axis = sec_axis(name="Total publications", ~. * max(df.years$n), breaks=scales::breaks_extended(10))) + 
  xlab("Year")  + 
  theme(panel.background = element_blank(), axis.ticks.x = element_blank(), axis.title.x = element_text(margin = margin(-15,0,0,0, "pt")), axis.text.x = element_text(angle = 45, hjust = 1, size = 8, vjust = 2.4)) + 
  scale_fill_npg() 

ggsave("concepts_years.pdf", width = unit(13, "inch"), height = unit(6.5, "inch"))
```

